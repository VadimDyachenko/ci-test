build_environment: Ubuntu 14.04
language: java
jdk:
    - oraclejdk8

integrations:
  hub:
    - integrationName: shippable_integration    #replace with your integration name
      type: dockerRegistryLogin

build:
  cache: true
  cache_dir_list:
    - /root/.gradle/caches
  ci:
    - sudo docker ps -a
    - docker rm $(docker ps --filter "status=exited" -q) || true
    - git merge origin master
    - git name-rev --name-only MERGE_HEAD
    - cp -a ./. /build/
    - docker run --name=gradle -u root --rm --volumes-from $SHIPPABLE_CONTAINER_NAME -w /build romach007/gradle-build:1.0 gradle clean build --stacktrace

  post_ci:
    - cd /build
    - ls -l
    - if [ "$IS_PULL_REQUEST" != true -a "$BRANCH" == "master"]; then ./detect-changed-services.sh; fi

notifications:
    email:
        recipients:
            - vadim.dyachenko@gmail.co